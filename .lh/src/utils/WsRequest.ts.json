{
    "sourceFile": "src/utils/WsRequest.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 14,
            "patches": [
                {
                    "date": 1681620849693,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1681621008356,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,9 +5,10 @@\n  * @LastEditTime: 2023-04-16 12:54:08\n  * @LastEditors: Allen OYang allenwill211@gmail.com\n  * @FilePath: /speak-gpt/src/utils/WsRequest.ts\n  */\n-class WSRequest {\n+\n+export class WSRequest {\n   private url: string;\n   protected ws: WebSocket | null = null;\n \n   constructor (url: string) {\n"
                },
                {
                    "date": 1681621550605,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,23 +1,26 @@\n /*\n  * @Author: Allen OYang\n  * @Email:  allenwill211@gmail.com\n  * @Date: 2023-04-16 12:52:14\n- * @LastEditTime: 2023-04-16 12:54:08\n+ * @LastEditTime: 2023-04-16 13:05:49\n  * @LastEditors: Allen OYang allenwill211@gmail.com\n  * @FilePath: /speak-gpt/src/utils/WsRequest.ts\n  */\n \n export class WSRequest {\n   private url: string;\n-  protected ws: WebSocket | null = null;\n+  private ws: WebSocket | null = null;\n+  private headers?: { [key: string]: string };\n \n-  constructor (url: string) {\n+  constructor (url: string, headers: { [key: string]: string } = {}) {\n     this.url = url;\n+    this.headers = headers;\n   }\n \n   public connect(): void {\n     try {\n+\n       this.ws = new WebSocket(this.url);\n       this.ws.onopen = this.onOpen.bind(this);\n       this.ws.onmessage = this.onMessage.bind(this);\n       this.ws.onerror = this.onError.bind(this);\n"
                },
                {
                    "date": 1681632989669,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n /*\n  * @Author: Allen OYang\n  * @Email:  allenwill211@gmail.com\n  * @Date: 2023-04-16 12:52:14\n- * @LastEditTime: 2023-04-16 13:05:49\n+ * @LastEditTime: 2023-04-16 16:16:29\n  * @LastEditors: Allen OYang allenwill211@gmail.com\n  * @FilePath: /speak-gpt/src/utils/WsRequest.ts\n  */\n \n@@ -18,9 +18,9 @@\n   }\n \n   public connect(): void {\n     try {\n-\n+      console.log('this.url', this.url)\n       this.ws = new WebSocket(this.url);\n       this.ws.onopen = this.onOpen.bind(this);\n       this.ws.onmessage = this.onMessage.bind(this);\n       this.ws.onerror = this.onError.bind(this);\n"
                },
                {
                    "date": 1681634278796,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,17 +1,19 @@\n /*\n  * @Author: Allen OYang\n  * @Email:  allenwill211@gmail.com\n  * @Date: 2023-04-16 12:52:14\n- * @LastEditTime: 2023-04-16 16:16:29\n+ * @LastEditTime: 2023-04-16 16:37:57\n  * @LastEditors: Allen OYang allenwill211@gmail.com\n  * @FilePath: /speak-gpt/src/utils/WsRequest.ts\n  */\n+import EventEmitter from \"events\";\n \n export class WSRequest {\n   private url: string;\n   private ws: WebSocket | null = null;\n   private headers?: { [key: string]: string };\n+  public event: EventEmitter = new EventEmitter();\n \n   constructor (url: string, headers: { [key: string]: string } = {}) {\n     this.url = url;\n     this.headers = headers;\n@@ -20,21 +22,40 @@\n   public connect(): void {\n     try {\n       console.log('this.url', this.url)\n       this.ws = new WebSocket(this.url);\n-      this.ws.onopen = this.onOpen.bind(this);\n-      this.ws.onmessage = this.onMessage.bind(this);\n-      this.ws.onerror = this.onError.bind(this);\n-      this.ws.onclose = this.onClose.bind(this);\n+      this.addEvent()\n     } catch (e) {\n       console.log(`Error connecting to ${this.url}: ${e}`);\n     }\n   }\n \n-  protected onOpen(event: Event): void { }\n+  public addEvent() {\n+    this.ws!.addEventListener('open', this.onOpen);\n+    this.ws!.addEventListener('message', this.onMessage);\n+    this.ws!.addEventListener('close', this.onClose);\n+    this.ws!.addEventListener('error', this.onError);\n+  }\n \n-  protected onMessage(event: MessageEvent): void { }\n+  public removeEvent() {\n+    this.ws!.removeEventListener('open', this.onOpen);\n+    this.ws!.removeEventListener('message', this.onMessage);\n+    this.ws!.removeEventListener('close', this.onClose);\n+    this.ws!.removeEventListener('error', this.onError);\n+  }\n \n-  protected onError(event: Event): void { }\n+  protected onOpen(event: Event): void {\n+    this.event.emit('open', event)\n+  }\n \n-  protected onClose(event: CloseEvent): void { }\n+  protected onMessage(event: MessageEvent): void {\n+    this.event.emit('message', event)\n+  }\n+\n+  protected onError(event: Event): void {\n+    this.event.emit('error', event)\n+   }\n+\n+  protected onClose(event: CloseEvent): void {\n+    this.event.emit('close', event)\n+   }\n }\n"
                },
                {
                    "date": 1681634552054,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,13 +1,13 @@\n /*\n  * @Author: Allen OYang\n  * @Email:  allenwill211@gmail.com\n  * @Date: 2023-04-16 12:52:14\n- * @LastEditTime: 2023-04-16 16:37:57\n+ * @LastEditTime: 2023-04-16 16:42:32\n  * @LastEditors: Allen OYang allenwill211@gmail.com\n  * @FilePath: /speak-gpt/src/utils/WsRequest.ts\n  */\n-import EventEmitter from \"events\";\n+import EventEmitter from \"eventemitter3\";\n \n export class WSRequest {\n   private url: string;\n   private ws: WebSocket | null = null;\n"
                },
                {
                    "date": 1681635157251,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n /*\n  * @Author: Allen OYang\n  * @Email:  allenwill211@gmail.com\n  * @Date: 2023-04-16 12:52:14\n- * @LastEditTime: 2023-04-16 16:42:32\n+ * @LastEditTime: 2023-04-16 16:52:37\n  * @LastEditors: Allen OYang allenwill211@gmail.com\n  * @FilePath: /speak-gpt/src/utils/WsRequest.ts\n  */\n import EventEmitter from \"eventemitter3\";\n@@ -42,20 +42,20 @@\n     this.ws!.removeEventListener('close', this.onClose);\n     this.ws!.removeEventListener('error', this.onError);\n   }\n \n-  protected onOpen(event: Event): void {\n+  private onOpen(event: Event): void {\n     this.event.emit('open', event)\n   }\n \n-  protected onMessage(event: MessageEvent): void {\n+  private onMessage(event: MessageEvent): void {\n     this.event.emit('message', event)\n   }\n \n-  protected onError(event: Event): void {\n+  private onError(event: Event): void {\n     this.event.emit('error', event)\n    }\n \n-  protected onClose(event: CloseEvent): void {\n+   private onClose(event: CloseEvent): void {\n     this.event.emit('close', event)\n    }\n }\n"
                },
                {
                    "date": 1681635235064,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n /*\n  * @Author: Allen OYang\n  * @Email:  allenwill211@gmail.com\n  * @Date: 2023-04-16 12:52:14\n- * @LastEditTime: 2023-04-16 16:52:37\n+ * @LastEditTime: 2023-04-16 16:53:55\n  * @LastEditors: Allen OYang allenwill211@gmail.com\n  * @FilePath: /speak-gpt/src/utils/WsRequest.ts\n  */\n import EventEmitter from \"eventemitter3\";\n@@ -16,8 +16,9 @@\n \n   constructor (url: string, headers: { [key: string]: string } = {}) {\n     this.url = url;\n     this.headers = headers;\n+    console.log('this.event', this.event)\n   }\n \n   public connect(): void {\n     try {\n@@ -43,8 +44,9 @@\n     this.ws!.removeEventListener('error', this.onError);\n   }\n \n   private onOpen(event: Event): void {\n+\n     this.event.emit('open', event)\n   }\n \n   private onMessage(event: MessageEvent): void {\n"
                },
                {
                    "date": 1681635286600,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -30,19 +30,19 @@\n     }\n   }\n \n   public addEvent() {\n-    this.ws!.addEventListener('open', this.onOpen);\n-    this.ws!.addEventListener('message', this.onMessage);\n-    this.ws!.addEventListener('close', this.onClose);\n-    this.ws!.addEventListener('error', this.onError);\n+    this.ws!.addEventListener('open', this.onOpen.bind(this));\n+    this.ws!.addEventListener('message', this.onMessage.bind(this));\n+    this.ws!.addEventListener('close', this.onClose.bind(this));\n+    this.ws!.addEventListener('error', this.onError.bind(this));\n   }\n \n   public removeEvent() {\n-    this.ws!.removeEventListener('open', this.onOpen);\n-    this.ws!.removeEventListener('message', this.onMessage);\n-    this.ws!.removeEventListener('close', this.onClose);\n-    this.ws!.removeEventListener('error', this.onError);\n+    this.ws!.removeEventListener('open', this.onOpen.bind(this));\n+    this.ws!.removeEventListener('message', this.onMessage.bind(this));\n+    this.ws!.removeEventListener('close', this.onClose.bind(this));\n+    this.ws!.removeEventListener('error', this.onError.bind(this));\n   }\n \n   private onOpen(event: Event): void {\n \n"
                },
                {
                    "date": 1681635333842,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -44,9 +44,8 @@\n     this.ws!.removeEventListener('error', this.onError.bind(this));\n   }\n \n   private onOpen(event: Event): void {\n-\n     this.event.emit('open', event)\n   }\n \n   private onMessage(event: MessageEvent): void {\n"
                },
                {
                    "date": 1681635393947,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n /*\n  * @Author: Allen OYang\n  * @Email:  allenwill211@gmail.com\n  * @Date: 2023-04-16 12:52:14\n- * @LastEditTime: 2023-04-16 16:53:55\n+ * @LastEditTime: 2023-04-16 16:56:33\n  * @LastEditors: Allen OYang allenwill211@gmail.com\n  * @FilePath: /speak-gpt/src/utils/WsRequest.ts\n  */\n import EventEmitter from \"eventemitter3\";\n@@ -48,9 +48,9 @@\n     this.event.emit('open', event)\n   }\n \n   private onMessage(event: MessageEvent): void {\n-    this.event.emit('message', event)\n+    this.event.emit('message', JSON.parse(event.data))\n   }\n \n   private onError(event: Event): void {\n     this.event.emit('error', event)\n"
                },
                {
                    "date": 1681635424536,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n /*\n  * @Author: Allen OYang\n  * @Email:  allenwill211@gmail.com\n  * @Date: 2023-04-16 12:52:14\n- * @LastEditTime: 2023-04-16 16:56:33\n+ * @LastEditTime: 2023-04-16 16:57:04\n  * @LastEditors: Allen OYang allenwill211@gmail.com\n  * @FilePath: /speak-gpt/src/utils/WsRequest.ts\n  */\n import EventEmitter from \"eventemitter3\";\n@@ -48,9 +48,9 @@\n     this.event.emit('open', event)\n   }\n \n   private onMessage(event: MessageEvent): void {\n-    this.event.emit('message', JSON.parse(event.data))\n+    // this.event.emit('message', JSON.parse(event.data))\n   }\n \n   private onError(event: Event): void {\n     this.event.emit('error', event)\n"
                },
                {
                    "date": 1681635440435,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n /*\n  * @Author: Allen OYang\n  * @Email:  allenwill211@gmail.com\n  * @Date: 2023-04-16 12:52:14\n- * @LastEditTime: 2023-04-16 16:57:04\n+ * @LastEditTime: 2023-04-16 16:56:33\n  * @LastEditors: Allen OYang allenwill211@gmail.com\n  * @FilePath: /speak-gpt/src/utils/WsRequest.ts\n  */\n import EventEmitter from \"eventemitter3\";\n@@ -48,15 +48,15 @@\n     this.event.emit('open', event)\n   }\n \n   private onMessage(event: MessageEvent): void {\n-    // this.event.emit('message', JSON.parse(event.data))\n+    this.event.emit('message', event.data)\n   }\n \n   private onError(event: Event): void {\n     this.event.emit('error', event)\n-   }\n+  }\n \n-   private onClose(event: CloseEvent): void {\n+  private onClose(event: CloseEvent): void {\n     this.event.emit('close', event)\n-   }\n+  }\n }\n"
                },
                {
                    "date": 1681635480806,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n /*\n  * @Author: Allen OYang\n  * @Email:  allenwill211@gmail.com\n  * @Date: 2023-04-16 12:52:14\n- * @LastEditTime: 2023-04-16 16:56:33\n+ * @LastEditTime: 2023-04-16 16:58:00\n  * @LastEditors: Allen OYang allenwill211@gmail.com\n  * @FilePath: /speak-gpt/src/utils/WsRequest.ts\n  */\n import EventEmitter from \"eventemitter3\";\n@@ -48,9 +48,9 @@\n     this.event.emit('open', event)\n   }\n \n   private onMessage(event: MessageEvent): void {\n-    this.event.emit('message', event.data)\n+    this.event.emit('message', JSON.parse(event.data))\n   }\n \n   private onError(event: Event): void {\n     this.event.emit('error', event)\n"
                },
                {
                    "date": 1681635665601,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -43,8 +43,12 @@\n     this.ws!.removeEventListener('close', this.onClose.bind(this));\n     this.ws!.removeEventListener('error', this.onError.bind(this));\n   }\n \n+  public send(data: any) {\n+    this.ws!.send(data)\n+  }\n+\n   private onOpen(event: Event): void {\n     this.event.emit('open', event)\n   }\n \n"
                }
            ],
            "date": 1681620849693,
            "name": "Commit-0",
            "content": "/*\n * @Author: Allen OYang\n * @Email:  allenwill211@gmail.com\n * @Date: 2023-04-16 12:52:14\n * @LastEditTime: 2023-04-16 12:54:08\n * @LastEditors: Allen OYang allenwill211@gmail.com\n * @FilePath: /speak-gpt/src/utils/WsRequest.ts\n */\nclass WSRequest {\n  private url: string;\n  protected ws: WebSocket | null = null;\n\n  constructor (url: string) {\n    this.url = url;\n  }\n\n  public connect(): void {\n    try {\n      this.ws = new WebSocket(this.url);\n      this.ws.onopen = this.onOpen.bind(this);\n      this.ws.onmessage = this.onMessage.bind(this);\n      this.ws.onerror = this.onError.bind(this);\n      this.ws.onclose = this.onClose.bind(this);\n    } catch (e) {\n      console.log(`Error connecting to ${this.url}: ${e}`);\n    }\n  }\n\n  protected onOpen(event: Event): void { }\n\n  protected onMessage(event: MessageEvent): void { }\n\n  protected onError(event: Event): void { }\n\n  protected onClose(event: CloseEvent): void { }\n}\n"
        }
    ]
}